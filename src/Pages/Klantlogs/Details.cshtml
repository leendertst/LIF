@page
@using Lif.Models
@model Lif.Pages.Klantlogs.DetailsModel
@{
    ViewData["Title"] = $"Klantlog Week {Model.Klantlog.WeekNummer}";
}

<div class="page-header mb-4">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a asp-page="Index">
                    <i class="bi bi-clipboard-check"></i> Klantlogs
                </a>
            </li>
            <li class="breadcrumb-item active" aria-current="page">Details</li>
        </ol>
    </nav>
    <h1><i class="bi bi-clipboard-data"></i> Klantlog Week @Model.Klantlog.WeekNummer - @Model.Klantlog.Jaar</h1>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card mb-4">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="bi bi-info-circle"></i> Klantlog Informatie
                </h5>
                @{
                    var statusBadge = Model.Klantlog.Status switch
                    {
                        KlantlogStatus.Concept => "bg-secondary",
                        KlantlogStatus.Definitief => "bg-success",
                        KlantlogStatus.Afgerond => "bg-info",
                        KlantlogStatus.Geannuleerd => "bg-danger",
                        _ => "bg-secondary"
                    };
                }
                <span class="badge @statusBadge">@Model.Klantlog.Status</span>
            </div>
            <div class="card-body">
                <dl class="row mb-0">
                    <dt class="col-sm-4">
                        <i class="bi bi-person me-2"></i>Klant
                    </dt>
                    <dd class="col-sm-8">
                        @Model.Klantlog.User.Email
                    </dd>

                    <dt class="col-sm-4">
                        <i class="bi bi-calendar-week me-2"></i>Week / Jaar
                    </dt>
                    <dd class="col-sm-8">
                        Week @Model.Klantlog.WeekNummer van @Model.Klantlog.Jaar
                    </dd>

                    <dt class="col-sm-4">
                        <i class="bi bi-calendar me-2"></i>Datum
                    </dt>
                    <dd class="col-sm-8">
                        @Model.Klantlog.Datum.ToString("dddd d MMMM yyyy")
                    </dd>

                    @if (Model.Klantlog.DefinitiefGemaaktOp.HasValue)
                    {
                        <dt class="col-sm-4">
                            <i class="bi bi-check-circle me-2"></i>Definitief gemaakt
                        </dt>
                        <dd class="col-sm-8">
                            @Model.Klantlog.DefinitiefGemaaktOp.Value.ToString("dd-MM-yyyy HH:mm")
                        </dd>
                    }

                    @if (!string.IsNullOrEmpty(Model.Klantlog.Opmerkingen))
                    {
                        <dt class="col-sm-4">
                            <i class="bi bi-chat-left-text me-2"></i>Opmerkingen
                        </dt>
                        <dd class="col-sm-8">
                            @Model.Klantlog.Opmerkingen
                        </dd>
                    }
                </dl>
            </div>
        </div>

        <!-- Producten lijst -->
        <div class="card">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">
                    <i class="bi bi-box-seam"></i> Producten
                </h5>
            </div>
            <div class="card-body">
                @if (Model.Klantlog.KlantlogProducten.Any())
                {
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead>
                                <tr>
                                    <th>Product</th>
                                    <th class="text-center">Aantal</th>
                                    <th class="text-end">Prijs per stuk</th>
                                    <th class="text-end">Totaal</th>
                                    @if (Model.Klantlog.Status == KlantlogStatus.Concept && Model.CanEdit)
                                    {
                                        <th></th>
                                    }
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var klantlogProduct in Model.Klantlog.KlantlogProducten.OrderBy(kp => kp.Product.Naam))
                                {
                                    <tr>
                                        <td>
                                            <strong>@klantlogProduct.Product.Naam</strong>
                                            @if (!string.IsNullOrEmpty(klantlogProduct.Product.Beschrijving))
                                            {
                                                <br />
                                                <small class="text-muted">@klantlogProduct.Product.Beschrijving</small>
                                            }
                                        </td>
                                        <td class="text-center">
                                            <span class="badge bg-primary">@klantlogProduct.Aantal</span>
                                        </td>
                                        <td class="text-end">
                                            @klantlogProduct.Product.Prijs.ToString("C")
                                        </td>
                                        <td class="text-end">
                                            <strong>@((klantlogProduct.Aantal * klantlogProduct.Product.Prijs).ToString("C"))</strong>
                                        </td>
                                        @if (Model.Klantlog.Status == KlantlogStatus.Concept && Model.CanEdit)
                                        {
                                            <td class="text-end">
                                                <form method="post" asp-page-handler="VerwijderProduct" 
                                                      asp-route-klantlogId="@Model.Klantlog.Id" 
                                                      asp-route-productId="@klantlogProduct.ProductId"
                                                      class="d-inline">
                                                    <button type="submit" class="btn btn-sm btn-danger"
                                                            onclick="return confirm('Weet je zeker dat je dit product wilt verwijderen?')">
                                                        <i class="bi bi-trash"></i>
                                                    </button>
                                                </form>
                                            </td>
                                        }
                                    </tr>
                                }
                            </tbody>
                            <tfoot>
                                <tr class="table-active">
                                    <td colspan="3" class="text-end"><strong>Totaalprijs:</strong></td>
                                    <td class="text-end">
                                        <strong class="fs-5 text-success">@Model.Klantlog.TotaalPrijs.ToString("C")</strong>
                                    </td>
                                    @if (Model.Klantlog.Status == KlantlogStatus.Concept && Model.CanEdit)
                                    {
                                        <td></td>
                                    }
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                }
                else
                {
                    <div class="alert alert-warning mb-0">
                        <i class="bi bi-exclamation-triangle me-2"></i>
                        Er zijn nog geen producten toegevoegd aan deze klantlog.
                    </div>
                }
            </div>
        </div>

        <div class="mt-4">
            @if (Model.Klantlog.Status == KlantlogStatus.Concept && Model.CanEdit)
            {
                <a asp-page="Edit" asp-route-id="@Model.Klantlog.Id" class="btn btn-warning">
                    <i class="bi bi-pencil"></i> Bewerken
                </a>
            }
            <a asp-page="Index" class="btn btn-secondary">
                <i class="bi bi-arrow-left"></i> Terug naar lijst
            </a>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card">
            <div class="card-header bg-info text-white">
                <h6 class="mb-0">
                    <i class="bi bi-bar-chart"></i> Samenvatting
                </h6>
            </div>
            <div class="card-body">
                <div class="d-flex justify-content-between mb-3">
                    <span><i class="bi bi-box-seam text-primary"></i> Aantal producten:</span>
                    <strong>@Model.Klantlog.KlantlogProducten.Count</strong>
                </div>
                <div class="d-flex justify-content-between mb-3">
                    <span><i class="bi bi-123 text-primary"></i> Totaal aantal items:</span>
                    <strong>@Model.Klantlog.KlantlogProducten.Sum(kp => kp.Aantal)</strong>
                </div>
                <div class="d-flex justify-content-between">
                    <span><i class="bi bi-currency-euro text-success"></i> Totaalprijs:</span>
                    <strong class="text-success">@Model.Klantlog.TotaalPrijs.ToString("C")</strong>
                </div>
            </div>
        </div>
    </div>
</div>